@import 'tailwindcss';

@plugin '@tailwindcss/typography';

@custom-variant dark (&:where(.dark, .dark *));

@theme {
  --font-sans:
    'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
    'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif,
    'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';

  --color-accent-light: #666666;
  --color-accent: #444444;
  --color-accent-dark: #333333;

  --color-dark: #000000;
  --color-card: #101010;
  --color-card-light: #f5f5f5;
}

:root {
  --card-bg-light: #f5f5f5;
  --card-bg-dark: #101010;
}

@utility card-hover {
  @apply dark:hover:bg-dark border border-gray-200/20 transition-all duration-200 hover:border-gray-200/40 hover:bg-gray-200 dark:border-gray-800/20 dark:hover:border-gray-800/40;
}

/* Code block container */
pre,
[data-rehype-pretty-code-fragment] pre {
  @apply my-6 overflow-x-auto rounded-lg border border-gray-200/50 dark:border-gray-800/50;
  background-color: var(--card-bg-light) !important;
  padding: 1.25rem !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.dark pre,
.dark [data-rehype-pretty-code-fragment] pre {
  background-color: var(--card-bg-dark) !important;
}

/* Override any inline background styles from rehype-pretty-code */
pre,
pre > *,
[data-rehype-pretty-code-fragment],
[data-rehype-pretty-code-fragment] > *,
[data-rehype-pretty-code-fragment] code,
[data-rehype-pretty-code-fragment] div {
  background: var(--card-bg-light) !important;
}

.dark pre,
.dark pre > *,
.dark [data-rehype-pretty-code-fragment],
.dark [data-rehype-pretty-code-fragment] > *,
.dark [data-rehype-pretty-code-fragment] code,
.dark [data-rehype-pretty-code-fragment] div {
  background: var(--card-bg-dark) !important;
}

/* Code element inside pre */
pre > code {
  @apply grid w-full border-0 bg-transparent break-words;
  counter-reset: line;
  box-decoration-break: clone;
  font-size: 0.9rem;
  line-height: 1.75;
  display: grid !important;
  padding: 0 !important;
  width: 100% !important;
}

/* Dual-theme syntax coloring via shiki CSS variables */
pre code span {
  color: var(--shiki-light);
  font-size: 0.9rem !important;
}

.dark pre code span {
  color: var(--shiki-dark) !important;
  font-size: 0.9rem !important;
}

/* Line styling */
span[data-line] {
  @apply block;
  padding: 0.2rem 0;
  line-height: 1.75;
  min-height: 1.6rem;
}

/* Highlighted lines */
[data-highlighted-line] {
  @apply -mx-4 border-l-4 border-yellow-500 bg-yellow-50/30 px-4 dark:bg-yellow-900/30;
}

/* Line numbers */
[data-line-numbers] > [data-line]::before {
  @apply mr-4 inline-block w-4 text-right text-gray-400;
  content: attr(data-line);
  user-select: none;
}

/* Code title */
[data-rehype-pretty-code-title] {
  @apply dark:bg-card rounded-t-lg border border-b-0 border-gray-200 bg-gray-100 px-4 py-2 font-mono text-sm font-semibold text-gray-800 dark:border-gray-800 dark:text-gray-200;
}

/* Fragment container */
[data-rehype-pretty-code-fragment] {
  @apply overflow-hidden rounded-lg;
}

/* Inline code (not inside pre) */
.prose :not(pre) > code {
  @apply rounded-md bg-gray-100 px-1.5 py-0.5 text-gray-700 dark:bg-gray-800 dark:text-gray-200;
  font-size: 0.9rem;
}

/* Highlighted words */
.prose pre code .word {
  @apply rounded-sm px-1 py-0.5;
}

/* Blockquote cleanup */
.prose blockquote p:first-of-type::before {
  content: none;
}
.prose blockquote p:last-of-type::after {
  content: none;
}
